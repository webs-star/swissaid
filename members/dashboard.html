<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Members — Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--brand:#0C2856;--accent:#F5C22D;--bg:#f8fafc}
body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:#0f1724}
.header{background:var(--brand);color:#fff;padding:14px 20px;display:flex;justify-content:space-between;align-items:center}
.header a{color:#fff;text-decoration:none;font-weight:700}
.container{max-width:1100px;margin:28px auto;padding:0 18px}
.grid{display:grid;grid-template-columns:1fr 320px;gap:20px}
.card{background:#fff;border-radius:12px;padding:18px;box-shadow:0 8px 20px rgba(2,6,23,0.06)}
.actions a{display:inline-block;margin-right:8px;padding:8px 12px;border-radius:8px;text-decoration:none;background:#eef2ff;color:var(--brand);font-weight:600}
.small{font-size:14px;color:#475569}
@media(max-width:820px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<header class="header">
  <a href="/"><strong>Swiss Aid Foundation</strong></a>
  <div>
    <a href="profile.html" style="margin-right:10px;color:#fff">My Profile</a>
    <a href="events.html" style="margin-right:10px;color:#fff">Events</a>
    <a href="announcements.html" style="margin-right:14px;color:#fff">Announcements</a>
    <button id="logoutBtn" style="background:var(--accent);border:none;padding:8px 12px;border-radius:8px;cursor:pointer">Logout</button>
  </div>
</header>

<main class="container">
  <div class="grid">
    <div>
      <div class="card">
        <h2 id="welcome">Welcome</h2>
        <p class="small" id="memberSummary">Loading profile…</p>

        <div style="margin-top:18px">
          <a class="actions" href="profile.html">Edit Profile</a>
          <a class="actions" href="events.html">View Events</a>
          <a class="actions" href="announcements.html">Read Announcements</a>
        </div>
      </div>

      <div class="card" style="margin-top:18px;">
        <h3>Quick Activity</h3>
        <div id="joinedEvents"><p class="small">Loading joined events…</p></div>
      </div>
    </div>

    <aside>
      <div class="card">
        <h3>Account</h3>
        <p><strong id="accountEmail">—</strong></p>
        <p class="small">Member ID: <span id="memberId">—</span></p>
      </div>

      <div class="card" style="margin-top:16px;">
        <h3>Useful Links</h3>
        <p class="small"><a href="/" style="color:var(--brand)">Home</a></p>
        <p class="small"><a href="/#joinPage" style="color:var(--brand)">Join / Login</a></p>
      </div>
    </aside>
  </div>
</main>

<!-- Firebase (v8 compat) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* ===== CONFIG – your provided config ===== */
const firebaseConfig = {
  apiKey: "AIzaSyAQNayCzqw8NwIRaky4o21TPMXvL1ED5Mc",
  authDomain: "swissaid-1e9c9.firebaseapp.com",
  databaseURL: "https://swissaid-1e9c9-default-rtdb.firebaseio.com",
  projectId: "swissaid-1e9c9",
  storageBucket: "swissaid-1e9c9.firebasestorage.app",
  messagingSenderId: "598813811284",
  appId: "1:598813811284:web:d4a9ebf46da0fb290043c1"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

/* ===== Auth guard ===== */
auth.onAuthStateChanged(async user => {
  if (!user) {
    // not signed in → redirect to home join
    window.location.href = "/#joinPage";
    return;
  }

  // show account info
  document.getElementById('accountEmail').textContent = user.email;
  document.getElementById('welcome').textContent = `Welcome, ${user.displayName || user.email}`;

  // load profile from Realtime DB
  const profileRef = db.ref('members/' + user.uid);
  const snap = await profileRef.once('value');
  const profile = snap.val() || {};

  document.getElementById('memberSummary').textContent =
    `${profile.fullName || '(name not set)'} · ${profile.country || '(country)'} · Joined: ${profile.joinedAt || '—'}`;
  document.getElementById('memberId').textContent = user.uid;

  // load joined events (simple)
  const signups = await db.ref('eventSignups').orderByChild('uid').equalTo(user.uid).once('value');
  const joined = signups.val() || {};
  const list = Object.keys(joined).length ? Object.keys(joined).map(k => `<li>${joined[k].eventTitle || 'Event'}</li>`).join('') : '<li>No joined events</li>';
  document.getElementById('joinedEvents').innerHTML = `<ul class="small">${list}</ul>`;
});

/* LOGOUT */
document.getElementById('logoutBtn').addEventListener('click', async () => {
  await auth.signOut();
  window.location.href = "/#joinPage";
});
</script>
</body>
</html>
