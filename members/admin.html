<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Members — Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--brand:#0C2856;--accent:#F5C22D}
body{font-family:Inter,Arial;background:#f8fafc;margin:0;color:#0f1724}
.header{background:var(--brand);color:#fff;padding:12px 18px}
.container{max-width:1000px;margin:24px auto;padding:0 18px}
.card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 8px 20px rgba(2,6,23,0.05);margin-bottom:14px}
label{display:block;margin-top:10px}
input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #d1d5db}
.btn{background:var(--brand);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
.small{font-size:13px;color:#475569}


  .members-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:16px;
}
.member-card{
  border:1px solid #e5e7eb;
  border-radius:12px;
  padding:14px;
  background:#f9fafb;
}
.member-card h4{
  margin:0;
  font-size:18px;
  color:var(--brand);
}
.member-meta{
  margin-top:6px;
  font-size:14px;
  color:#475569;
}

</style>
</head>
<body>
<header class="header" style="display:flex;align-items:center;gap:12px;">
  <img src="https://res.cloudinary.com/dwvt4e9o2/image/upload/v1763476964/Screenshot_73_e5hyu9.png" 
       alt="Swiss Aid Logo" 
       style="height:38px; width:auto;">

  <div style="display:flex;flex-direction:column;line-height:1;">
    <div style="color:#fff; font-size:18px; font-weight:700;">Swiss Aid Connect Foundation</div>
    <div style="color:#F5C22D; font-size:13px; font-weight:600;">Admin Panel</div>
  </div>
</header>




<main class="container">
  <!-- Announcement Section -->
  <div class="card">
    <h3>Create Announcement</h3>
    <label>Title</label><input id="annTitle" />
    <label>Body</label><textarea id="annBody" rows="4"></textarea>
    <button id="postAnn" class="btn">Post Announcement</button>
    <p id="annStatus" class="small"></p>
  </div>


<div class="card">
  <h3>Manage Announcements</h3>
  <div id="annList" class="small">Loading announcements…</div>
</div>



  
  <!-- Event Section -->
  <div class="card">
    <h3>Create Event</h3>
    <label>Title</label><input id="evTitle" />
    <label>Date</label><input id="evDate" placeholder="2025-12-01" />
    <label>Location</label><input id="evLoc" />
    <label>Description</label><textarea id="evDesc" rows="4"></textarea>
    <button id="createEvent" class="btn">Create Event</button>
    <p id="evStatus" class="small"></p>
  </div>

 <div class="card">
  <h3>Manage Events</h3>
  <div id="eventsList" class="small">Loading events…</div>
</div>


 <div class="card">
  <h3>All Joined Members</h3>
  <div id="membersGrid" class="members-grid">
    <p class="small">Loading members…</p>
  </div>
</div>

</main>




<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAQNayCzqw8NwIRaky4o21TPMXvL1ED5Mc",
  authDomain: "swissaid-1e9c9.firebaseapp.com",
  databaseURL: "https://swissaid-1e9c9-default-rtdb.firebaseio.com",
  projectId: "swissaid-1e9c9",
  storageBucket: "swissaid-1e9c9.firebasestorage.app",
  messagingSenderId: "598813811284",
  appId: "1:598813811284:web:d4a9ebf46da0fb290043c1"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

auth.onAuthStateChanged(async user => {
  if (!user) {
    window.location.href = '/#joinPage';
    return;
  }

  // check admin
  const aSnap = await db.ref('admins/' + user.uid).once('value');
  if (!aSnap.exists()) {
    alert('Access denied — admin only');
    window.location.href = '/members/dashboard.html';
    return;
  }

  // ✅ ADMIN: load everything
  loadMembers();
  loadAnnouncements();
  loadEvents();
});

/* ================= MEMBERS ================= */
async function loadMembers(){
  const snap = await db.ref('members').once('value');
  const members = snap.val() || {};

  let html = Object.keys(members).map(uid=>{
    const m = members[uid];
    return `
      <div class="member-card">
        <h4>${m.fullName || 'No name'}</h4>
        <div class="member-meta">${m.email || '—'}</div>
        <div class="member-meta">${m.country || '—'}</div>
        <div class="member-meta">Joined: ${m.joinedAt || '—'}</div>
      </div>
    `;
  }).join('');

  document.getElementById('membersGrid').innerHTML =
    html || '<p class="small">No members found</p>';
}

/* ================= ANNOUNCEMENTS ================= */
async function loadAnnouncements(){
  const snap = await db.ref('announcements').once('value');
  const anns = snap.val() || {};

  let html = Object.keys(anns).map(id=>{
    const a = anns[id];
    return `
      <div class="member-card">
        <h4>${a.title}</h4>
        <div class="member-meta">${a.body}</div>
        <button class="btn" onclick="editAnn('${id}')">Edit</button>
        <button class="btn" style="background:#dc2626" onclick="deleteAnn('${id}')">Delete</button>
      </div>
    `;
  }).join('');

  document.getElementById('annList').innerHTML =
    html || '<p>No announcements</p>';
}

async function deleteAnn(id){
  if(confirm('Delete this announcement?')){
    await db.ref('announcements/'+id).remove();
    loadAnnouncements();
  }
}

function editAnn(id){
  db.ref('announcements/'+id).once('value').then(s=>{
    annTitle.value = s.val().title;
    annBody.value = s.val().body;
    postAnn.textContent = 'Update Announcement';

    postAnn.onclick = async ()=>{
      await db.ref('announcements/'+id).update({
        title: annTitle.value,
        body: annBody.value
      });
      location.reload();
    };
  });
}

/* ================= EVENTS ================= */
async function loadEvents(){
  const snap = await db.ref('events').once('value');
  const events = snap.val() || {};

  let html = Object.keys(events).map(id=>{
    const e = events[id];
    return `
      <div class="member-card">
        <h4>${e.title}</h4>
        <div class="member-meta">${e.date || ''} · ${e.location || ''}</div>
        <div class="member-meta">${e.description || ''}</div>
        <button class="btn" onclick="editEvent('${id}')">Edit</button>
        <button class="btn" style="background:#dc2626" onclick="deleteEvent('${id}')">Delete</button>
      </div>
    `;
  }).join('');

  document.getElementById('eventsList').innerHTML =
    html || '<p>No events</p>';
}

async function deleteEvent(id){
  if(confirm('Delete this event?')){
    await db.ref('events/'+id).remove();
    loadEvents();
  }
}

function editEvent(id){
  db.ref('events/'+id).once('value').then(s=>{
    const e = s.val();
    evTitle.value = e.title;
    evDate.value = e.date;
    evLoc.value = e.location;
    evDesc.value = e.description;

    createEvent.textContent = 'Update Event';
    createEvent.onclick = async ()=>{
      await db.ref('events/'+id).update({
        title: evTitle.value,
        date: evDate.value,
        location: evLoc.value,
        description: evDesc.value
      });
      location.reload();
    };
  });
}

/* ================= CREATE ================= */
postAnn.addEventListener('click', async ()=>{
  if(postAnn.textContent !== 'Post Announcement') return;
  if(!annTitle.value || !annBody.value) return alert('Fill all fields');

  await db.ref('announcements').push({
    title: annTitle.value,
    body: annBody.value,
    createdAt: new Date().toISOString()
  });
  loadAnnouncements();
});

createEvent.addEventListener('click', async ()=>{
  if(createEvent.textContent !== 'Create Event') return;
  if(!evTitle.value) return alert('Title required');

  await db.ref('events').push({
    title: evTitle.value,
    date: evDate.value,
    location: evLoc.value,
    description: evDesc.value,
    createdAt: new Date().toISOString()
  });
  loadEvents();
});
  
</script>
</body>
</html>
